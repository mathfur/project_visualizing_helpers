#!/usr/bin/env ruby
# encoding: utf-8

$: << (File.dirname(__FILE__) + "/..")

require 'getoptlong'
require 'lib/project_visualizing_helpers'

usage = <<EOS
Usage: class_diagram2instance_diagram [file]
-v --version display version information and exit.
-n --nodes   display nodes
-e --edges   display edges
EOS

opts = GetoptLong.new(
  ['--help', '-h', GetoptLong::NO_ARGUMENT],
  ['--version', '-v', GetoptLong::NO_ARGUMENT],
  ['--nodes', '-n', GetoptLong::NO_ARGUMENT],
  ['--edges', '-e', GetoptLong::NO_ARGUMENT]
)

output_type = nil

begin
  opts.each do |opt, arg|
    case opt
    when '--help'; puts usage; exit
    when '--version'; puts ClassDiagram2InstanceDiagram::VERSION; exit
    when '--edges'
      output_type = :edges
    when '--nodes'
      output_type = :nodes
    end
  end
rescue StandardError => e
  puts "wrong option" + e.inspect
  exit
end

class2inst = ProjectVisualizingHelpers::ClassDiagram2InstanceDiagram.new(ARGF.read)

case output_type
when :edges
  puts class2inst.source_to_output_edges
when :nodes
  puts class2inst.source_to_output_nodes
else
  puts "[ERROR] A option --edges or --nodes has to be specified."
  exit
end
